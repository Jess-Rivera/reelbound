# Reelbound
## Project Context


### Diff
- **Removed:** consuming icons as they were placed into a reel from the icon pool  
  *(Problem: caused depletion bias — rare icons could only appear once per build.)*

- **Added:** weighted sampling from the pool to create reels  
  *(Goal: preserve pool weights, fix rarity behavior.)*  
  - **Method:** Reels now sample weights without mutating the pool, allowing rare (weight 1) icons to appear multiple times while still being low probability.


### Up Next
- Create a stop button that stops Reel 1, then on second press stops Reel 2, repeat until Reel N. This creates a skill based slot machine instead of random. (system, UX, UI)
  - will need to significantly slow reel spin speed to allow for skill expression (system)
  - will need to create a preview of icon that is next but not in the scoring grid (UI)
  - visible and functional timer will be needed to add pressure, so that all reels stop if timer reaches 0 and any reel is still spinning (system, UX, UI)
- Horizontal spinning begins after the vertical is done. (system, UI, UX)
  - include preview
  - update timer based on number of required stops


### Idea Landing


--- 
### Summary
- Browser-based slot machine prototype built with TypeScript and a lightweight DOM UI.
- Configuration-driven design: machine behavior, icon weights, and gameplay tuning live in JSON/data tables.
- Core gameplay loop managed entirely on the client; Vite toolchain handles bundling and local dev.

### File Structure
- `index.html` – Bootstrap document that hosts the canvas/DOM containers for reels, controls, and debug output.
- `ascii_slot_demo.html`, `temp_index.html` – Alternate/demo entry points kept for experimentation.
- `src/` – Primary application source.
  - `core/` – Core engine pieces such as `slotMachine.ts` (runtime builder, reel logic) and `reelHandler.ts` (canvas animation).
  - `data/` – Static JSON and tables (`iconMetaTable.ts`, `machines/selectableMachines.json`, `defaultPool` weights).
  - `engine/` – Legacy or shared engine utilities (e.g., win evaluation, RNG helpers) leveraged by the core layer.
  - `game/` – Game-state orchestration (`run/roundManager.ts`, systems like `systems/heatSystem.ts`).
  - `types/` – Central TypeScript type declarations and runtime validators.
  - `ui/` – DOM-driven helpers and inspector panels (`reelInspector.ts`, controls, HUD pieces).
  - `main.ts` – Client entry; wires configs, creates runtime, instantiates systems, and kicks off the loop/UI.
- `docs/` – Project documentation (this file, additional design notes as added).
- `dist/` – Build artifacts generated by Vite.
- `public/assets` (via `dist/assets`) – Icon sprites and visual resources.
- Tooling files (`vite.config.ts`, `tsconfig.json`, `.eslintrc.cjs`, etc.) – Build, lint, and formatting configuration.

### Major Systems
- **Machine Runtime Composer** (`src/core/slotMachine.ts`, `buildRuntime`) – Merges default icon weights, machine JSON overrides, and metadata into a single `MachineRuntime` object; ensures downstream code sees a finalized, validated configuration.
- **Reel Generation & State** (`src/core/slotMachine.ts`, `generateReelStrips` & `SlotMachine` class) – Creates weighted reel strips using the configured pool, maintains reel positions, and exposes spin/preview helpers.
- **Win Evaluation** (`src/core/winEvaluator.ts`) – Analyzes a grid produced by `SlotMachine` to detect patterns, calculate multipliers, and return payouts plus pattern metadata.
- **Round & Heat Management** (`src/game/run/roundManager.ts`, `src/game/systems/heatSystem.ts`) – Encapsulates spin pacing, round progression, credit accounting, and heat/HP interactions driving the combat loop.
- **Reel Rendering & Animation** (`src/core/reelHandler.ts`) – Handles DOM/canvas updates for reel visuals, synchronizes animation frames with spin results, and cooperates with the inspector.
- **UI & Debugging Panels** (`src/ui/reelInspector.ts`, `index.html` markup) – Provides interactive tools for inspecting reel composition, reordering reels, and visualizing runtime state.
- **Data Catalogs** (`src/data/iconMetaTable.ts`, `src/data/machines/selectableMachines.json`, `src/data/defaultPool.ts`) – Source of truth for icon metadata, machine presets, and base probability pools consumed during runtime composition.
- **Type System & Validation** (`src/types/index.ts`) – Defines shared types (icons, configs, runtime structures) along with runtime guards that vet JSON before it reaches the core logic.

### Interaction Flow
- `main.ts` loads machine JSON, validates it, and builds a `MachineRuntime`.
- The runtime is injected into `SlotMachine`, which generates reel strips and exposes spin APIs.
- `RoundManager` and `HeatSystem` coordinate gameplay, invoking spins and processing results.
- `ReelHandler` and UI components render the reels, inspector, and debug output based on the latest machine state.

